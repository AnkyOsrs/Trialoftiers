<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OSRS Trial of Tiers Tracker</title>

  <!-- Use the uploaded TTF (put runescape_bold.ttf in same folder as this HTML) -->
  <style>
    @font-face {
      font-family: "RunescapeOS";
      src: url("runescape_bold.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --container-w: 1000px;
      --container-h: 600px;
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#222;
      font-family: "RunescapeOS", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      padding:20px;
    }

    /* Notification bar (small toast) */
    #notification-bar{
      position:fixed;
      top:424px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(18,18,18,0);
      color:#03db47;
      text-shadow:
        0 1px 0 rgba(0,0,0,0.9),
        0 6px 20px rgba(0,0,0,0.6),
        0 0 6px rgba(0,0,0,0.6);
      padding:10px 16px;
      border-radius:8px;
      box-shadow:0 6px 18px rgba(0,0,0,0.6);
      z-index:2000;
      opacity:0;
      pointer-events:none;
      transition:opacity .28s ease;
      font-size:20px;
      font-family: "RunescapeOS", serif;
    }
    #notification-bar.show{ opacity:1; pointer-events:auto; }

    /* Main image container */
     #image-container {
            position: relative;
            /* REMINDER: Replace 'Lit up OSRS Bossing Canvas.jpg' with your actual file name. */
            background-image: url('OSRS_Bossing_Canvas_Lit_up.png');
            background-size: contain;
            background-repeat: no-repeat;
            /* REMINDER: Adjust these dimensions to match your image file's exact size */
            width: 1000px;
            height: 600px; 
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
        }

    }

     /* Percentage display centered inside image */
    #percent-wrap{
      position:absolute;
      left: 200px;   /* adjust X position */
    top: 150px;    /* adjust Y position */
    transform: none;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none; /* clicks go to tiles */
      z-index:1500;
      width:300px;
      height:120px;

    }

    #percent {
      font-family: "RunescapeOS", serif;
      font-size:64px;
      line-height:1;
      font-weight:700;
      color:#03db47;
      text-shadow:
        0 1px 0 rgba(0,0,0,0.9),
        0 6px 20px rgba(0,0,0,0.6),
        0 0 6px rgba(0,0,0,0.6);
      display:inline-block;
      padding:176px 443px;
      border-radius:8px;

      transform-origin:center;
      transition: transform 220ms cubic-bezier(.2,.9,.2,1), color 200ms;
      pointer-events:none;
    }

    /* Pop animation for the main percent when it changes */
    .pop {
      animation: pop-scale 420ms cubic-bezier(.2,.9,.2,1);
    }
    @keyframes pop-scale {
      0% { transform: scale(0.6); filter:brightness(1); }
      40% { transform: scale(1.18); filter:brightness(1.15); }
      100% { transform: scale(1); }
    }

    /* XP-drop style floating element */
    .xp-drop {
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%, -10px);
      font-family:"RunescapeOS", serif;
      font-size:22px;
      font-weight:700;
      pointer-events:none;
      text-shadow: 0 1px 0 rgba(0,0,0,0.95);
      will-change: transform, opacity;
      z-index:1600;
      color:#a6ff7a; /* XP color-ish */
      animation: xp-float 1100ms ease-out forwards;
    }

    @keyframes xp-float {
      0% { opacity: 1; transform: translate(-50%, 0) scale(0.95); }
      20% { transform: translate(-50%, -18px) scale(1.05); }
      60% { opacity: 1; transform: translate(-50%, -52px) scale(1.02); }
      100% { opacity: 0; transform: translate(-50%, -88px) scale(1.0); }
    }

    /* Tier Completed glow overlay */
    #tier-badge {
      position:absolute;
      left:50%;
      bottom:88%;
      transform:translateX(-50%);
      font-family:"RunescapeOS", serif;
      padding:10px 18px;
      border-radius:10px;
      font-size:20px;
      letter-spacing:0.6px;
      display:none;
      z-index:1700;
      pointer-events:none;
      color:#fff;
      text-shadow:
        0 1px 0 rgba(0,0,0,0.9),
        0 0 16px rgba(255,215,100,1);
      background:linear-gradient(180deg, rgba(255,240,180,0.07), rgba(0,0,0,0.25));
    }

    /* glow effect applied to container when 100% */
    #image-container.tier-complete::after {
      content: "";
      position: absolute;
      inset: -14px;
      border-radius: 10px;
      z-index: 1400;
      pointer-events: none;
      box-shadow:
        0 0 18px rgba(255,220,80,0.85),
        0 0 60px rgba(255,160,50,0.55),
        inset 0 0 30px rgba(255,240,200,0.08);
      animation: glow-pulse 1200ms ease-in-out infinite alternate;
    }

    @keyframes glow-pulse {
      from { filter: drop-shadow(0 0 10px rgba(255,220,80,0.7)); transform: none; }
      to { filter: drop-shadow(0 0 26px rgba(255,160,50,0.9)); transform: translateY(-2px); }
    }

    #image-container.tier-complete #percent {
      color: #fff9e6;
      text-shadow:
        0 1px 0 rgba(0,0,0,0.95),
        0 0 8px rgba(255,240,120,0.7),
        0 0 14px rgba(255,200,60,0.6);
    }

    #image-container.tier-complete #tier-badge {
      display:block;
      animation: badge-pop 700ms cubic-bezier(.2,.9,.2,1);
    }
    @keyframes badge-pop {
      0% { transform: translate(-50%, 20px) scale(0.8); opacity:0; }
      60% { transform: translate(-50%, -6px) scale(1.06); opacity:1; }
      100% { transform: translate(-50%, 0) scale(1); opacity:1; }
    }

    /* Boss tiles styles retained */
    .boss-tile {
      position:absolute;
      cursor:pointer;
      background-color: transparent;
      transition: box-shadow 0.18s ease, transform 0.12s;
      overflow:hidden;
      z-index:1200;
      /* shape */
      clip-path: polygon(
          15% 0%, 85% 0%, 100% 15%, 100% 85%, 85% 100%, 15% 100%, 0% 85%, 0% 15%
      );
    }
    .boss-tile.completed {
      background: linear-gradient(180deg, rgba(0,200,90,0.12), rgba(134,241,182,0.08));
      box-shadow: inset 0 0 8px rgba(0,200,80);
    }

    /* keep your tile coordinates (copied/kept from your original) */
    /* row 1 */
    #Obor { top: 20px; left: 20px; width: 71px; height: 71px; }
    #Bryophyta { top: 20px; left: 94px; width: 71px; height: 71px; }
    #Giant-Mole { top: 20px; left: 167px; width: 71px; height: 71px; }
    #Scurrius { top: 20px; left: 241px; width: 71px; height: 71px; }
    #Sarachnis { top: 20px; left: 314px; width: 71px; height: 71px; }
    #Prime { top: 20px; left: 615px; width: 71px; height: 71px; }
    #Supreme { top: 20px; left: 688px; width: 71px; height: 71px; }
    #Rex { top: 20px; left: 761px; width: 71px; height: 71px; }
    #Calvarion { top: 20px; left: 835px; width: 71px; height: 71px; }
    #Spindel { top: 20px; left: 908px; width: 71px; height: 71px; }
    /* row 2 */
    #KBD { top: 94px; left: 20px; width: 71px; height: 71px; }
    #Amoxliatl { top: 94px; left: 94px; width: 71px; height: 71px; }
    #Barrows { top: 94px; left: 314px; width: 71px; height: 71px; }
    #Jad { top: 94px; left: 463px; width: 71px; height: 71px; }
    #Chaos-Elemental { top: 94px; left: 615px; width: 71px; height: 71px; }
    #Hueycoatl { top: 94px; left: 835px; width: 71px; height: 71px; }
    #Artio { top: 94px; left: 908px; width: 71px; height: 71px; }
    /* row 3 */
    #Crazy-Archaeologist { top: 167px; left: 20px; width: 71px; height: 71px; }
    #Chaos-Fanatic { top: 167px; left: 94px; width: 71px; height: 71px; }
    #Deranged-Archaeologist { top: 167px; left: 167px; width: 71px; height: 71px; }
    #Royal-Titans { top: 167px; left: 241px; width: 71px; height: 71px; }
    #Moons { top: 167px; left: 314px; width: 71px; height: 71px; }
    #Scorpia { top: 167px; left: 615px; width: 71px; height: 71px; }
    #Grotesque-Guardians { top: 167px; left: 688px; width: 71px; height: 71px; }
    #Zalcano { top: 167px; left: 761px; width: 71px; height: 71px; }
    #Kracken { top: 167px; left: 835px; width: 71px; height: 71px; }
    #Kalphite-Queen { top: 167px; left: 908px; width: 71px; height: 71px; }
    /* row 4 */
    #Hespori { top: 245px; left: 22px; width: 71px; height: 71px; }
    #Skotizo { top: 245px; left: 908px; width: 71px; height: 71px; }
    #Inferno { top: 304px; left: 422px; width: 71px; height: 71px; }
    #Fortis-Colosseum { top: 304px; left: 514px; width: 71px; height: 71px; }
    #Kreearra { top: 324px; left: 20px; width: 71px; height: 71px; }
    #General-Graardor { top: 324px; left: 94px; width: 71px; height: 71px; }
    #Kril-Tsutsaroth { top: 324px; left: 167px; width: 71px; height: 71px; }
    #Commander-Zilyana { top: 324px; left: 241px; width: 71px; height: 71px; }
    #Zulrah { top: 324px; left: 314px; width: 71px; height: 71px; }
    #Araxxor { top: 324px; left: 615px; width: 71px; height: 71px; }
    #Cerberus { top: 324px; left: 688px; width: 71px; height: 71px; }
    #Alchemical-Hydra { top: 324px; left: 761px; width: 71px; height: 71px; }
    #Nex { top: 324px; left: 835px; width: 71px; height: 71px; }
    #Tombs-of-Amascut { top: 324px; left: 908px; width: 71px; height: 71px; }
    /* row 5 */
    #Vorkath { top: 397px; left: 20px; width: 71px; height: 71px; }
    #Phantom-Muspah { top: 397px; left: 94px; width: 71px; height: 71px; }
    #Nightmare { top: 397px; left: 314px; width: 71px; height: 71px; }
    #Thermonuclear-Smoke-Devil { top: 397px; left: 387px; width: 71px; height: 71px; }
    #Phosanis-Nightmare { top: 397px; left: 543px; width: 71px; height: 71px; }
    #Corrupted-Hunllef { top: 397px; left: 616px; width: 71px; height: 71px; }
    #Doom-of-Mokhaiotl { top: 397px; left: 835px; width: 71px; height: 71px; }
    #Chambers-of-Xeric { top: 397px; left: 908px; width: 71px; height: 71px; }
    /* row 6 */
    #Callisto { top: 471px; left: 20px; width: 71px; height: 71px; }
    #Vetion { top: 471px; left: 94px; width: 71px; height: 71px; }
    #Venenatis { top: 471px; left: 167px; width: 71px; height: 71px; }
    #Hunllef { top: 471px; left: 241px; width: 71px; height: 71px; }
    #Abyssal-Sire { top: 471px; left: 314px; width: 71px; height: 71px; }
    #Corporeal-Beast { top: 471px; left: 387px; width: 71px; height: 71px; }
    #Duke-Sucellus { top: 471px; left: 543px; width: 71px; height: 71px; }
    #The-Leviathan { top: 471px; left: 615px; width: 71px; height: 71px; }
    #The-Whisperer { top: 471px; left: 688px; width: 71px; height: 71px; }
    #Vardorvis { top: 471px; left: 761px; width: 71px; height: 71px; }
    #Yama { top: 471px; left: 835px; width: 71px; height: 71px; }
    #Theatre-of-Blood { top: 471px; left: 908px; width: 71px; height: 71px; }

    /* small helper link area for downloading font if needed */
    #helpers {
      margin-top:14px;
      display:flex;
      gap:12px;
      justify-content:center;
      width:100%;
      max-width:var(--container-w);
    }
    #helpers a {
      color:#fff;
      text-decoration:none;
      background:rgba(0,0,0,0.45);
      padding:8px 12px;
      border-radius:8px;
      font-size:13px;
      box-shadow:0 6px 14px rgba(0,0,0,0.6);
    }

    /* small responsive tweak */
    @media (max-width:1100px){
      :root{ --container-w: 92vw; --container-h: calc(92vw * 0.6); }
      #percent { font-size: clamp(40px, 6vw, 64px); }
      #percent-wrap { width: 220px; height:100px; }
    }
  </style>
</head>
<body>

  <audio id="completion-sound" src="UniqueDrop.mp3" preload="auto"></audio>
  
  <div id="notification-bar" aria-live="polite"></div>

  <div id="image-container" role="application" aria-label="OSRS Trial of Tiers tracker">
    <div id="percent-wrap" aria-hidden="true">
      <div id="percent">0%</div>
    </div>


    <!-- boss tiles (click to toggle) -->
    <div id="Obor" class="boss-tile" onclick="toggleComplete('Obor')"></div>
    <div id="Bryophyta" class="boss-tile" onclick="toggleComplete('Bryophyta')"></div>
    <div id="Giant-Mole" class="boss-tile" onclick="toggleComplete('Giant-Mole')"></div>
    <div id="Scurrius" class="boss-tile" onclick="toggleComplete('Scurrius')"></div>
    <div id="Sarachnis" class="boss-tile" onclick="toggleComplete('Sarachnis')"></div>
    <div id="Prime" class="boss-tile" onclick="toggleComplete('Prime')"></div>
    <div id="Supreme" class="boss-tile" onclick="toggleComplete('Supreme')"></div>
    <div id="Rex" class="boss-tile" onclick="toggleComplete('Rex')"></div>
    <div id="Calvarion" class="boss-tile" onclick="toggleComplete('Calvarion')"></div>
    <div id="Spindel" class="boss-tile" onclick="toggleComplete('Spindel')"></div>
    <div id="KBD" class="boss-tile" onclick="toggleComplete('KBD')"></div>
    <div id="Amoxliatl" class="boss-tile" onclick="toggleComplete('Amoxliatl')"></div>
    <div id="Barrows" class="boss-tile" onclick="toggleComplete('Barrows')"></div>
    <div id="Jad" class="boss-tile" onclick="toggleComplete('Jad')"></div>
    <div id="Chaos-Elemental" class="boss-tile" onclick="toggleComplete('Chaos-Elemental')"></div>
    <div id="Hueycoatl" class="boss-tile" onclick="toggleComplete('Hueycoatl')"></div>
    <div id="Artio" class="boss-tile" onclick="toggleComplete('Artio')"></div>
    <div id="Crazy-Archaeologist" class="boss-tile" onclick="toggleComplete('Crazy-Archaeologist')"></div>
    <div id="Chaos-Fanatic" class="boss-tile" onclick="toggleComplete('Chaos-Fanatic')"></div>
    <div id="Deranged-Archaeologist" class="boss-tile" onclick="toggleComplete('Deranged-Archaeologist')"></div>
    <div id="Royal-Titans" class="boss-tile" onclick="toggleComplete('Royal-Titans')"></div>
    <div id="Moons" class="boss-tile" onclick="toggleComplete('Moons')"></div>
    <div id="Scorpia" class="boss-tile" onclick="toggleComplete('Scorpia')"></div>
    <div id="Grotesque-Guardians" class="boss-tile" onclick="toggleComplete('Grotesque-Guardians')"></div>
    <div id="Zalcano" class="boss-tile" onclick="toggleComplete('Zalcano')"></div>
    <div id="Kracken" class="boss-tile" onclick="toggleComplete('Kracken')"></div>
    <div id="Kalphite-Queen" class="boss-tile" onclick="toggleComplete('Kalphite-Queen')"></div>
    <div id="Hespori" class="boss-tile" onclick="toggleComplete('Hespori')"></div>
    <div id="Skotizo" class="boss-tile" onclick="toggleComplete('Skotizo')"></div>
    <div id="Inferno" class="boss-tile" onclick="toggleComplete('Inferno')"></div>
    <div id="Fortis-Colosseum" class="boss-tile" onclick="toggleComplete('Fortis-Colosseum')"></div>
    <div id="Kreearra" class="boss-tile" onclick="toggleComplete('Kreearra')"></div>
    <div id="General-Graardor" class="boss-tile" onclick="toggleComplete('General-Graardor')"></div>
    <div id="Kril-Tsutsaroth" class="boss-tile" onclick="toggleComplete('Kril-Tsutsaroth')"></div>
    <div id="Commander-Zilyana" class="boss-tile" onclick="toggleComplete('Commander-Zilyana')"></div>
    <div id="Zulrah" class="boss-tile" onclick="toggleComplete('Zulrah')"></div>
    <div id="Araxxor" class="boss-tile" onclick="toggleComplete('Araxxor')"></div>
    <div id="Cerberus" class="boss-tile" onclick="toggleComplete('Cerberus')"></div>
    <div id="Alchemical-Hydra" class="boss-tile" onclick="toggleComplete('Alchemical-Hydra')"></div>
    <div id="Nex" class="boss-tile" onclick="toggleComplete('Nex')"></div>
    <div id="Tombs-of-Amascut" class="boss-tile" onclick="toggleComplete('Tombs-of-Amascut')"></div>
    <div id="Vorkath" class="boss-tile" onclick="toggleComplete('Vorkath')"></div>
    <div id="Phantom-Muspah" class="boss-tile" onclick="toggleComplete('Phantom-Muspah')"></div>
    <div id="Nightmare" class="boss-tile" onclick="toggleComplete('Nightmare')"></div>
    <div id="Thermonuclear-Smoke-Devil" class="boss-tile" onclick="toggleComplete('Thermonuclear-Smoke-Devil')"></div>
    <div id="Phosanis-Nightmare" class="boss-tile" onclick="toggleComplete('Phosanis-Nightmare')"></div>
    <div id="Corrupted-Hunllef" class="boss-tile" onclick="toggleComplete('Corrupted-Hunllef')"></div>
    <div id="Doom-of-Mokhaiotl" class="boss-tile" onclick="toggleComplete('Doom-of-Mokhaiotl')"></div>
    <div id="Chambers-of-Xeric" class="boss-tile" onclick="toggleComplete('Chambers-of-Xeric')"></div>
    <div id="Callisto" class="boss-tile" onclick="toggleComplete('Callisto')"></div>
    <div id="Vetion" class="boss-tile" onclick="toggleComplete('Vetion')"></div>
    <div id="Venenatis" class="boss-tile" onclick="toggleComplete('Venenatis')"></div>
    <div id="Hunllef" class="boss-tile" onclick="toggleComplete('Hunllef')"></div>
    <div id="Abyssal-Sire" class="boss-tile" onclick="toggleComplete('Abyssal-Sire')"></div>
    <div id="Corporeal-Beast" class="boss-tile" onclick="toggleComplete('Corporeal-Beast')"></div>
    <div id="Duke-Sucellus" class="boss-tile" onclick="toggleComplete('Duke-Sucellus')"></div>
    <div id="The-Leviathan" class="boss-tile" onclick="toggleComplete('The-Leviathan')"></div>
    <div id="The-Whisperer" class="boss-tile" onclick="toggleComplete('The-Whisperer')"></div>
    <div id="Vardorvis" class="boss-tile" onclick="toggleComplete('Vardorvis')"></div>
    <div id="Yama" class="boss-tile" onclick="toggleComplete('Yama')"></div>
    <div id="Theatre-of-Blood" class="boss-tile" onclick="toggleComplete('Theatre-of-Blood')"></div>
  </div>


  <script>
    // boss list
    const bossTiles = [
      'Obor','Bryophyta','Giant-Mole','Scurrius','Sarachnis','Prime','Supreme','Rex','Calvarion',
      'Spindel','KBD','Amoxliatl','Barrows','Jad','Chaos-Elemental','Hueycoatl','Artio',
      'Crazy-Archaeologist','Chaos-Fanatic','Deranged-Archaeologist','Royal-Titans','Moons','Scorpia','Grotesque-Guardians','Zalcano',
      'Kracken','Kalphite-Queen','Hespori','Skotizo','Inferno','Fortis-Colosseum','Kreearra','General-Graardor',
      'Kril-Tsutsaroth','Commander-Zilyana','Zulrah','Araxxor','Cerberus','Alchemical-Hydra','Nex','Tombs-of-Amascut',
      'Vorkath','Phantom-Muspah','Nightmare','Thermonuclear-Smoke-Devil','Phosanis-Nightmare','Corrupted-Hunllef','Doom-of-Mokhaiotl','Chambers-of-Xeric',
      'Callisto','Vetion','Venenatis','Hunllef','Abyssal-Sire','Corporeal-Beast','Duke-Sucellus','The-Leviathan',
      'The-Whisperer','Vardorvis','Yama','Theatre-of-Blood'
    ];

    const storageKey = 'osrsBossTrackerProgress_v2';
    const percentEl = document.getElementById('percent');
    const imgContainer = document.getElementById('image-container');
    const toast = document.getElementById('notification-bar');

    // helper: show small toast
    function showNotification(msg, ms = 2200){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toast._hideTimeout);
      toast._hideTimeout = setTimeout(()=> toast.classList.remove('show'), ms);
    }

    // toggle a tile's completion
   function toggleComplete(bossId){
  const tile = document.getElementById(bossId);
  if(!tile) return;

  tile.classList.toggle('completed');

  const wasComplete = tile.classList.contains('completed');
  const displayName = bossId.replace('boss-','Boss #');

  const msg = wasComplete ? `${displayName} marked as COMPLETE!` : `${displayName} marked as INCOMPLETE.`;
  showNotification(msg, 1600);

  // ðŸ”Š PLAY SOUND WHEN TILE BECOMES COMPLETED
  if (wasComplete) {
    const sound = document.getElementById("completion-sound");
    sound.currentTime = 0;
    sound.play().catch(()=>{});
  }

  saveProgress();
  const {percent, delta} = updatePercentAndReturnDelta();
  animatePercentChange(percent, delta, wasComplete);
}


    // save progress to localStorage
    function saveProgress(){
      const progress = {};
      bossTiles.forEach(id=>{
        const tile = document.getElementById(id);
        progress[id] = !!(tile && tile.classList.contains('completed'));
      });
      localStorage.setItem(storageKey, JSON.stringify(progress));
    }

    // load progress and set initial UI
    function loadProgress(){
      const raw = localStorage.getItem(storageKey);
      if(!raw) return updatePercentAndReturnDelta(); // compute initial
      try {
        const progress = JSON.parse(raw);
        bossTiles.forEach(id=>{
          const tile = document.getElementById(id);
          if(tile && progress[id]) tile.classList.add('completed');
          else if(tile) tile.classList.remove('completed');
        });
      } catch(e){
        console.warn('Failed to parse progress', e);
      }
      return updatePercentAndReturnDelta();
    }

    // calculate percent and apply tier-complete visuals if needed
    function updatePercentAndReturnDelta(){
      const total = bossTiles.length;
      let completed = 0;
      bossTiles.forEach(id=>{
        const tile = document.getElementById(id);
        if(tile && tile.classList.contains('completed')) completed++;
      });
      const percent = Math.round((completed / total) * 100);
      return applyPercent(percent);
    }

    // apply percent to DOM and return object {percent, delta} where delta is change from previous percent
    function applyPercent(newPercent){
      const oldText = parseInt(percentEl.dataset.lastPercent || '0', 10);
      const delta = newPercent - oldText;

      // set main text
      percentEl.textContent = newPercent + '%';
      // add pop
      percentEl.classList.remove('pop');
      // force reflow to restart animation
      void percentEl.offsetWidth;
      percentEl.classList.add('pop');

      // update stored last percent
      percentEl.dataset.lastPercent = newPercent;

      // tier complete / glow
      if(newPercent === 100){
        imgContainer.classList.add('tier-complete');
        // subtle notification
        showNotification('Trial of Tiers Completed!', 2600);
      } else {
        imgContainer.classList.remove('tier-complete');
      }

      return {percent:newPercent, delta};
    }

    // xp-drop animation: create floating element and show change
    function animatePercentChange(percent, delta){
      // always show a small XP-drop for the new percent (like OSRS)
      const xp = document.createElement('div');
      xp.className = 'xp-drop';
      // show +N% if positive delta else show percent
      if(delta > 0) xp.textContent = `+${delta}%`;
      else if(delta < 0) xp.textContent = `${delta}%`;
      else xp.textContent = `${percent}%`;

      // position it near the percentWrap (center)
      const wrap = document.getElementById('percent-wrap');
      wrap.appendChild(xp);

      // remove element after animation finishes
      xp.addEventListener('animationend', ()=> xp.remove());

      // extra sparkle/pop for 100%
      if(percent === 100 || becameCompleteFlag){
        // small extra burst text
        const burst = document.createElement('div');
        burst.className = 'xp-drop';
        burst.style.fontSize = '28px';
        burst.style.color = '#fff1b3';
        burst.style.textShadow = '0 0 12px rgba(255,220,90,0.95)';
        burst.textContent = '100%';
        wrap.appendChild(burst);
        burst.addEventListener('animationend', ()=> burst.remove());
      }
    }

    // reset helper
    function resetProgress(){
      if(!confirm('Reset all progress?')) return;
      bossTiles.forEach(id=>{
        const tile = document.getElementById(id);
        if(tile) tile.classList.remove('completed');
      });
      saveProgress();
      applyPercent(0);
      showNotification('Progress reset.');
    }

    // initialize on load
    (function init(){
      // ensure percent dataset has a base
      if(!percentEl.dataset.lastPercent) percentEl.dataset.lastPercent = '0';

      // load progress from storage and set UI
      const { percent } = loadProgress() || {percent:0};
      // small initial pop so it doesn't look dead
      percentEl.classList.add('pop');
      // accessibility: announce initial percent
      setTimeout(()=> {
        const p = parseInt(percentEl.textContent.replace('%',''),10) || 0;
        if(p === 100) imgContainer.classList.add('tier-complete');
      }, 240);

      // keyboard support: allow toggling selected tile with Enter if focused
      document.querySelectorAll('.boss-tile').forEach(el=>{
        el.tabIndex = 0;
        el.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); el.click(); }
        });
      });
    })();
  </script>
</body>
</html>
